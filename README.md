# カスタムファイル自動作成（Solana用、2025年版）
SolanaのTxからCryptactのカスタムファイルを自動生成するPythonツール  
CryptactはSolanaに対応しているが使い物にならなかったので自作（おまけでSuiにも対応）  

## 概要
・Txを自動判別しカスタムファイルとして出力  
・対応取引はスワップ、ブリッジ、一部のレンディング、送金  
・NFT・流動性提供には未対応（未対応取引は「不明」と区別して出力）  

## 注意事項
・自己責任での使用をお願いします  
・クリプタクトのヘルプファイルに分類・転記していますが、間違いがある可能性があります  
・個人用のため対応取引に偏りがあります  
・一方で、対応外の取引は誤判定の可能性があるので、全取引の確認を強く推奨します  
・Python初心者がAIに頼りっぱなしで開発（見苦しい点はご容赦を）  

## 仕組み
・主にProgram log: Instructionを使用してTxを判別  
・同一ログメッセージの異なる取引による誤判定リスクあり  
・Tx取得は無料枠のAPI制限（600Tx/分、1万Txで16分強）  

## 開発環境
・OS：Windows11  
・Python3.13.3  
・エンコード：cp932（Macの方はご注意下さい）  
・外部ライブラリ  
　・requests,pandas,numpy,xlsxwriter,tqdm  
　・Suiのみ：asyncio,aiohttp  

## Solanaの利用方法（Suiは後述）
### 必須準備  
1.APIキー取得（無料枠でOK）  
　Alchemy、Heliusに登録  
2.設定ファイル編集  
　config.iniにAPIキー、ウォレットアドレスなどを記入  
3.トークンリスト作成  
　python token_list.py  
　data/Token - {your_address}.csv が生成される  
　SymbolのティッカーをCryptact対応ティッカーに変更  
ティッカー変更ルール  
・未対応コインはUSER-○○を使用（DEFI-○○は使用しない）  
・特定コイン  
　　sUSD　→　USER-SUSD  
　　PST　→　USER-PST  
　　mPST　→　USER-MPST  

### オプション設定  
Birdeye API（価格データ取得用）  
・未対応コイン同士のスワップ時の価格取得に使用  
・月500件制限のため1時間足で取得  
・不要ならAPIキーの入力不要 → 価格取得自体をスキップする  

### 1.実行  
python main.py  

### 2.出力ファイル確認  
・custom.xlsx が生成される  
　・CryptactStandardシート：カスタムファイル  
　・dfシート：取得したTxの生データ（Solscan風）  
　・Lendingシート：レンディング利息計算  
　・sUSDシート: sUSD償還・鋳造記録  
　・PST･mPSTシート: PST,mPST記録（閲覧用、Swapとしてカスタムファイルに計上済み）  

### 3.後処理（重要）  
・「不要」取引：各自で調査し適切な値を記入  
・「注意Swap」：未対応コイン同士のスワップ、価格の確認・未取得なら補完  
・レンディング利息：Lendingシートから計算結果をカスタムファイルへ転記（入出金にかかるガス代は計上済み）  
・USDの償還・鋳造記録：価格などに異常がないか確認の上カスタムファイルへ転記  
・CryptactStandardシートからTx列を削除してアップロード  

## 対応取引
1.スワップ  
・Jupiter,Titanを使ったスワップにはほぼ対応  
・SOLの売買や2hop取引でWSOLは挟む場合などは未対応（不明になる）  
・ウォレットスワップは未対応  
・Pumpfun、Raydiumでのスワップは使ってないので分からない  

2.Scam  
・ダスティング攻撃：BONUS  
・$○○AirdropのようなcNFTの送りつけ：除外  
・scam.txtに記入の送信者（scammers）で判別、リストに追加すればそちらも自動除外する  

3.送金・入金  
・ほぼ対応  
・送金手数料の計上のみ  

4.ブリッジ  
・Portalはほぼ対応、それ以外は未対応  
・PortalでのCCTP利用によるUSDC自動付与（6月ぐらいに始まったサービス）  
　　ガス代はPortal持ちなので、カスタムファイルからは除外  
・Jupiter、StargateのCCTPに対応、それ以外は不明  

5.レンディング  
・USDCの預入のみ対応、他のコインやBorrowには未対応  
・Jupiter Lend、DeFiTuna、Save（旧Solend）のみ対応  

6.Jito tip  
・スワップに併せてtip支払い、単独でtip支払い、この両者に対応  

7.償還・鋳造  
・sUSD,PST,mPSTのみ対応  

8.その他  
・Tx失敗：ガス代のみ計上  
・Jupiter Limit Order：ガス代のみ計上、約定分は別途計算のこと  
・Jupiter投票、$JUPのアンロック周り、ごく一部のエアドロにも対応  
・これ以外の流動性提供やNFT関係は未対応  

## 補足
・ブリッジによるラップコイン（USDC,USDCETなど）は別コインとして扱われる  
・「ポジション不足」エラー回避のため、USDCET→USDCのスワップとして処理すればよい  
・[Gtaxも同様の原理（使い方の6参照）](https://note.com/salineras/n/n13dfe5eee8fa)

## サポート
質問やバグ報告はIssuesにお願いします  

## ライセンス
このソフトウェアは、コピー利用、配布、変更の追加、変更を加えたもの再配布、商用利用、有料販売など、どなたも自由にお使いいただくことができます。  
このソフトウェアの著作権表示（「Copyright (c) 年 作者名」）と、このライセンスの全文（英語の原文）を、ソースコードや、ソースコードに同梱したライセンス表示用の別ファイルなどに掲載してください。  
このソフトウェアには保証はついていません。  
このソフトウェアを利用したことで問題が起きた際に、ソフトウェアの製作者は一切の責任を負いません。  
